<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Graph Scale Identification Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    .question {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 5px #ccc;
      position: relative;
    }
    button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    input[type="text"] {
      font-size: 16px;
      padding: 5px;
      width: 100%;
      max-width: 400px;
      box-sizing: border-box;
    }
    #score {
      font-weight: bold;
      font-size: 18px;
      margin-top: 20px;
      text-align: center;
    }
    #feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 15px;
      background: white;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .paper-answer-space {
      border-bottom: 1px solid black;
      height: 25px;
      margin: 10px 0 20px 0;
      width: 100%;
      max-width: 400px;
    }
    #start-screen {
      text-align: center;
      margin-top: 50px;
    }
    #quiz-container, #paper-quiz-container {
      display: none;
    }
    .paper-grid {
      margin: 10px auto 20px auto;
      display: block;
      border: 1px solid #000;
      background: white;
    }
  </style>
</head>
<body>
  <h1>Graph Scale Identification Quiz</h1>

  <div id="start-screen">
    <button id="start-interactive-btn">Start Interactive Quiz</button>
    <button id="start-paper-btn">Generate Paper Quiz</button>
  </div>

  <div id="quiz-container">
    <div id="quiz-content"></div>
    <button id="next-btn" style="display:none;">Next Question</button>
    <div id="score"></div>
  </div>

  <div id="paper-quiz-container"></div>

  <script>
    const scales = [1, 2, 5, 10, 20, 25, 50, 100, 200, 500, 0.1, 0.2, 0.25, 0.5];

    function formatScale(scale) {
      if (scale < 1) {
        return scale.toFixed(2).replace(/\.?0+$/, '');
      }
      return scale.toString();
    }

    function randomTickLabels(totalTicks, minLabels, maxLabels) {
      const count = Math.floor(Math.random() * (maxLabels - minLabels + 1)) + minLabels;
      const possibleTicks = [];
      for (let i = 1; i < totalTicks; i++) {
        possibleTicks.push(i);
      }
      for (let i = possibleTicks.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [possibleTicks[i], possibleTicks[j]] = [possibleTicks[j], possibleTicks[i]];
      }
      return possibleTicks.slice(0, count).sort((a,b) => a-b);
    }

    function drawGrid(canvas, xScale, yScale, quadrants, partialLabels = false, partialLabelIndicesX = [], partialLabelIndicesY = [], hideLabels = false) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      ctx.clearRect(0, 0, width, height);

      const margin = 40;
      const gridWidth = width - 2 * margin;
      const gridHeight = height - 2 * margin;

      const intervalsX = quadrants === 1 ? 10 : 5;
      const intervalsY = quadrants === 1 ? 10 : 5;

      const totalIntervalsX = intervalsX * (quadrants === 4 ? 2 : 1);
      const totalIntervalsY = intervalsY * (quadrants === 4 ? 2 : 1);

      const pxPerIntervalX = gridWidth / totalIntervalsX;
      const pxPerIntervalY = gridHeight / totalIntervalsY;

      const originX = quadrants === 1 ? margin : margin + intervalsX * pxPerIntervalX;
      const originY = quadrants === 1 ? height - margin : margin + intervalsY * pxPerIntervalY;

      ctx.strokeStyle = '#aaa';
      ctx.lineWidth = 1;

      for (let i = 0; i <= totalIntervalsX; i++) {
        const x = margin + i * pxPerIntervalX;
        ctx.beginPath();
        ctx.moveTo(x, margin);
        ctx.lineTo(x, height - margin);
        ctx.stroke();
      }

      for (let i = 0; i <= totalIntervalsY; i++) {
        const y = margin + i * pxPerIntervalY;
        ctx.beginPath();
        ctx.moveTo(margin, y);
        ctx.lineTo(width - margin, y);
        ctx.stroke();
      }

      ctx.strokeStyle = 'black';
      ctx.lineWidth = 2;

      ctx.beginPath();
      ctx.moveTo(margin, originY);
      ctx.lineTo(width - margin, originY);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(originX, margin);
      ctx.lineTo(originX, height - margin);
      ctx.stroke();

      ctx.fillStyle = 'black';
      ctx.font = '12px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';

      for (let i = 0; i <= totalIntervalsX; i++) {
        const x = margin + i * pxPerIntervalX;
        const tickHeight = 6;
        ctx.beginPath();
        ctx.moveTo(x, originY - tickHeight / 2);
        ctx.lineTo(x, originY + tickHeight / 2);
        ctx.stroke();

        if (hideLabels) continue;

        if (partialLabels) {
          if (i === 0) continue;
          if (quadrants === 4) {
            const originIndex = intervalsX;
            if (i === originIndex - 1 || i === originIndex + 1) continue;
          } else if (quadrants === 1) {
            if (i === 1) continue;
          }
          if (!partialLabelIndicesX.includes(i)) continue;
        }

        let labelValue;
        if (quadrants === 1) {
          labelValue = formatScale(xScale * i);
        } else {
          labelValue = formatScale(xScale * (i - intervalsX));
        }
        ctx.fillText(labelValue, x, originY + tickHeight + 2);
      }

      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';

      for (let i = 0; i <= totalIntervalsY; i++) {
        const y = margin + i * pxPerIntervalY;
        const tickWidth = 6;
        ctx.beginPath();
        ctx.moveTo(originX - tickWidth / 2, y);
        ctx.lineTo(originX + tickWidth / 2, y);
        ctx.stroke();

        if (hideLabels) continue;

        if (partialLabels) {
          if (i === 0) continue;
          if (quadrants === 4) {
            const originIndex = intervalsY;
            if (i === originIndex - 1 || i === originIndex + 1) continue;
          } else if (quadrants === 1) {
            if (i === 1) continue;
          }
          if (!partialLabelIndicesY.includes(i)) continue;
        }

        let labelValue = formatScale(yScale * (intervalsY - i));
        ctx.fillText(labelValue, originX - tickWidth - 4, y);
      }
    }

    function generateScaleQuestion(quadrants, partialLabels = false) {
      const xScale = scales[Math.floor(Math.random() * scales.length)];
      const yScale = scales[Math.floor(Math.random() * scales.length)];

      let xRange, yRange, quadrantDesc;
      if (quadrants === 1) {
        xRange = `0 to ${formatScale(xScale * 10)}`;
        yRange = `0 to ${formatScale(yScale * 10)}`;
        quadrantDesc = "Quadrant 1 only (positive x and y)";
      } else {
        xRange = `${formatScale(-xScale * 5)} to ${formatScale(xScale * 5)}`;
        yRange = `${formatScale(-yScale * 5)} to ${formatScale(yScale * 5)}`;
        quadrantDesc = "All four quadrants (negative and positive x and y)";
      }

      let partialLabelIndicesX = [];
      let partialLabelIndicesY = [];
      if (partialLabels) {
        const intervalsX = quadrants === 1 ? 10 : 5;
        const intervalsY = quadrants === 1 ? 10 : 5;
        const totalTicksX = intervalsX * (quadrants === 4 ? 2 : 1);
        const totalTicksY = intervalsY * (quadrants === 4 ? 2 : 1);

        partialLabelIndicesX = randomTickLabels(totalTicksX, 3, 6);
        partialLabelIndicesY = randomTickLabels(totalTicksY, 3, 6);
      }

      return {
        type: "scale-identify",
        questionText: `Identify the scale on the x-axis and y-axis for the following Cartesian coordinate grid:<br>
        - ${quadrantDesc}<br>
        - x-axis range: ${xRange}<br>
        - y-axis range: ${yRange}<br>
        (Hint: The grid lines are evenly spaced according to the scale.)`,
        xScale,
        yScale,
        quadrants,
        partialLabels,
        partialLabelIndicesX,
        partialLabelIndicesY
      };
    }

    function generateAxisValuesQuestion(includeNegatives = false) {
      const xScale = scales[Math.floor(Math.random() * scales.length)];
      const yScale = scales[Math.floor(Math.random() * scales.length)];
      const intervals = 5;

      let xValues, yValues, questionText;

      if (includeNegatives) {
        xValues = Array.from({length: intervals * 2 + 1}, (_, i) => +(xScale * (i - intervals)).toFixed(5));
        yValues = Array.from({length: intervals * 2 + 1}, (_, i) => +(yScale * (i - intervals)).toFixed(5));
        questionText = `On the coordinate grid below, label the x-axis so that it has a scale (or interval) of <strong>${formatScale(xScale)}</strong> and the y-axis so that it has a scale (or interval) of <strong>${formatScale(yScale)}</strong>. There are 5 intervals on each side of zero, so please label the axes accordingly.`;
      } else {
        xValues = Array.from({length: intervals + 1}, (_, i) => +(xScale * i).toFixed(5));
        yValues = Array.from({length: intervals + 1}, (_, i) => +(yScale * i).toFixed(5));
        questionText = `On the coordinate grid below, label the x-axis so that it has a scale (or interval) of <strong>${formatScale(xScale)}</strong> and the y-axis so that it has a scale (or interval) of <strong>${formatScale(yScale)}</strong>. There are 5 intervals on each axis, so please label the axes accordingly.`;
      }

      return {
        type: "axis-values",
        questionText,
        xValues,
        yValues,
        includeNegatives
      };
    }

    const questions = [];

    const partialLabelIndices = new Set();
    while (partialLabelIndices.size < 2) {
      partialLabelIndices.add(Math.floor(Math.random() * 5));
    }

    for (let i = 0; i < 2; i++) {
      questions.push(generateScaleQuestion(1, partialLabelIndices.has(i)));
    }
    for (let i = 2; i < 5; i++) {
      questions.push(generateScaleQuestion(4, partialLabelIndices.has(i)));
    }

    for (let i = 0; i < 3; i++) {
      questions.push(generateAxisValuesQuestion(false));
    }
    for (let i = 0; i < 2; i++) {
      questions.push(generateAxisValuesQuestion(true));
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
    shuffle(questions);

    // Elements
    const startScreen = document.getElementById("start-screen");
    const quizContainer = document.getElementById("quiz-container");
    const quizContent = document.getElementById("quiz-content");
    const nextBtn = document.getElementById("next-btn");
    const scoreDiv = document.getElementById("score");
    const paperQuizContainer = document.getElementById("paper-quiz-container");

    let currentQuestionIndex = 0;
    let score = 0;

    // Show interactive quiz
    document.getElementById("start-interactive-btn").onclick = () => {
      startScreen.style.display = "none";
      paperQuizContainer.style.display = "none";
      quizContainer.style.display = "block";
      currentQuestionIndex = 0;
      score = 0;
      showQuestion();
      updateScore();
    };

    // Show paper quiz
    document.getElementById("start-paper-btn").onclick = () => {
      startScreen.style.display = "none";
      quizContainer.style.display = "none";
      paperQuizContainer.style.display = "block";
      generatePaperQuiz();
    };

    function showQuestion() {
      nextBtn.style.display = "none";
      const q = questions[currentQuestionIndex];
      quizContent.innerHTML = `<div class="question">
        <p><strong>Question ${currentQuestionIndex + 1} of ${questions.length}:</strong></p>
        <p>${q.questionText}</p>
        <div id="graph-container"></div>
        <div id="answer-area"></div>
        <div id="feedback"></div>
      </div>`;

      const answerArea = document.getElementById("answer-area");
      const feedback = document.getElementById("feedback");
      const graphContainer = document.getElementById("graph-container");

      if (q.type === "scale-identify") {
        const canvas = document.createElement("canvas");
        canvas.width = 500;
        canvas.height = 500;
        graphContainer.appendChild(canvas);

        drawGrid(canvas, q.xScale, q.yScale, q.quadrants, q.partialLabels, q.partialLabelIndicesX, q.partialLabelIndicesY, false);

        answerArea.innerHTML = `
          <label for="x-scale-input">Scale on x-axis: </label>
          <input type="text" id="x-scale-input" autocomplete="off" />
          <br />
          <label for="y-scale-input">Scale on y-axis: </label>
          <input type="text" id="y-scale-input" autocomplete="off" />
          <br />
          <button id="submit-btn">Submit</button>
        `;

        document.getElementById("submit-btn").onclick = () => {
          const xInput = document.getElementById("x-scale-input").value.trim();
          const yInput = document.getElementById("y-scale-input").value.trim();
          if (xInput === "" || yInput === "") {
            feedback.textContent = "Please enter both scales.";
            return;
          }
          if (xInput === formatScale(q.xScale) && yInput === formatScale(q.yScale)) {
            feedback.textContent = "Correct!";
            score++;
          } else {
            feedback.innerHTML = `Incorrect. The correct scales are x-axis: <strong>${formatScale(q.xScale)}</strong>, y-axis: <strong>${formatScale(q.yScale)}</strong>.`;
          }
          nextBtn.style.display = "inline-block";
          disableInputs();
          updateScore();
        };
      } else if (q.type === "axis-values") {
        answerArea.innerHTML = `
          <label for="x-values-input">x-axis values (comma separated): </label><br />
          <input type="text" id="x-values-input" autocomplete="off" style="width: 100%;" />
          <br />
          <label for="y-values-input">y-axis values (comma separated): </label><br />
          <input type="text" id="y-values-input" autocomplete="off" style="width: 100%;" />
          <br />
          <button id="submit-btn">Submit</button>
        `;

        document.getElementById("submit-btn").onclick = () => {
          const xInput = document.getElementById("x-values-input").value.trim();
          const yInput = document.getElementById("y-values-input").value.trim();
          if (xInput === "" || yInput === "") {
            feedback.textContent = "Please enter values for both axes.";
            return;
          }
          const xUserValues = xInput.split(",").map(s => parseFloat(s.trim()));
          const yUserValues = yInput.split(",").map(s => parseFloat(s.trim()));

          const xCorrect = q.xValues.map(v => parseFloat(v.toFixed(5)));
          const yCorrect = q.yValues.map(v => parseFloat(v.toFixed(5)));

          if (arraysEqualNumbers(xUserValues, xCorrect) && arraysEqualNumbers(yUserValues, yCorrect)) {
            feedback.textContent = "Correct!";
            score++;
          } else {
            feedback.innerHTML = `Incorrect.<br>Correct x-axis values: <strong>${q.xValues.join(", ")}</strong><br>Correct y-axis values: <strong>${q.yValues.join(", ")}</strong>`;
          }
          nextBtn.style.display = "inline-block";
          disableInputs();
          updateScore();
        };
      }
    }

    function disableInputs() {
      const inputs = quizContainer.querySelectorAll("input, button");
      inputs.forEach(el => {
        if (el.id !== "next-btn") el.disabled = true;
      });
    }

    function arraysEqualNumbers(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (isNaN(a[i]) || isNaN(b[i])) return false;
        if (Math.abs(a[i] - b[i]) > 0.0001) return false;
      }
      return true;
    }

    nextBtn.onclick = () => {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        showQuestion();
      } else {
        quizContainer.innerHTML = `<h2>Quiz complete!</h2><p>Your score: ${score} / ${questions.length}</p>`;
        nextBtn.style.display = 'none';
      }
    };

    function updateScore() {
      scoreDiv.textContent = `Score: ${score} / ${questions.length}`;
    }

    // Generate paper quiz HTML with blank grids for axis-values questions
    function generatePaperQuiz() {
      paperQuizContainer.innerHTML = "";
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";
        let questionHTML = `<p><strong>Question ${i + 1} of ${questions.length}:</strong></p>`;

        if (q.type === "scale-identify") {
          questionHTML += `<p>${q.questionText}</p>`;
          questionHTML += `<p><em>Answer: ____________________________</em></p>`;
          questionHTML += `<p><em>Answer: ____________________________</em></p>`;
        } else if (q.type === "axis-values") {
          questionHTML += `<p>${q.questionText}</p>`;

          // Create a canvas for blank coordinate grid
          const canvas = document.createElement("canvas");
          canvas.width = 300;
          canvas.height = 300;
          canvas.className = "paper-grid";

          // Append canvas after question text
          div.appendChild(canvas);

          // Draw blank grid (no labels)
          drawPaperGrid(canvas);

          // Add blank lines for answers
          questionHTML += `<p><em>Write the x-axis values on the grid above.</em></p>`;
          questionHTML += `<div class="paper-answer-space"></div>`;
          questionHTML += `<p><em>Write the y-axis values on the grid above.</em></p>`;
          questionHTML += `<div class="paper-answer-space"></div>`;

          div.innerHTML = questionHTML + div.innerHTML; // prepend instructions before canvas
        }

        paperQuizContainer.appendChild(div);
      });

      // Add a print button
      const printBtn = document.createElement("button");
      printBtn.textContent = "Print / Save as PDF";
      printBtn.onclick = () => window.print();
      paperQuizContainer.appendChild(printBtn);
    }

    // Draw blank 10x10 grid for paper quiz axis-values questions
    function drawPaperGrid(canvas) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      ctx.clearRect(0, 0, width, height);

      const margin = 30;
      const gridSize = 10; // 10 squares per axis
      const gridWidth = width - 2 * margin;
      const gridHeight = height - 2 * margin;
      const cellWidth = gridWidth / gridSize;
      const cellHeight = gridHeight / gridSize;

      ctx.strokeStyle = '#ccc';
      ctx.lineWidth = 1;

      // Vertical grid lines
      for (let i = 0; i <= gridSize; i++) {
        const x = margin + i * cellWidth;
        ctx.beginPath();
        ctx.moveTo(x, margin);
        ctx.lineTo(x, height - margin);
        ctx.stroke();
      }

      // Horizontal grid lines
      for (let i = 0; i <= gridSize; i++) {
        const y = margin + i * cellHeight;
        ctx.beginPath();
        ctx.moveTo(margin, y);
        ctx.lineTo(width - margin, y);
        ctx.stroke();
      }

      // Draw axes thicker and black
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 2;

      // x-axis in middle
      const originY = margin + gridSize / 2 * cellHeight;
      ctx.beginPath();
      ctx.moveTo(margin, originY);
      ctx.lineTo(width - margin, originY);
      ctx.stroke();

      // y-axis in middle
      const originX = margin + gridSize / 2 * cellWidth;
      ctx.beginPath();
      ctx.moveTo(originX, margin);
      ctx.lineTo(originX, height - margin);
      ctx.stroke();
    }
  </script>
</body>
</html>
